generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime? @db.Timestamptz(6)
  refreshTokenExpiresAt DateTime? @db.Timestamptz(6)
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt             DateTime  @db.Timestamptz(6)
  user                  user      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model documents {
  id                   String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  organizationId       String
  uploadedBy           String
  fileName             String
  filePath             String
  fileSize             Int?
  mimeType             String?
  errorMessage         String?
  extractedData        Json?
  extractionConfidence Float?          @db.Real
  aiModel              String?
  createdAt            DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt            DateTime        @default(now()) @db.Timestamptz(6)
  processedAt          DateTime?       @db.Timestamptz(6)
  documentType         document_type?
  status               document_status @default(pending)
  runId                String?
  organization         organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "documents_organization_id_fkey")
  user                 user            @relation(fields: [uploadedBy], references: [id], onDelete: SetNull, onUpdate: NoAction, map: "documents_uploadedby_fkey")

  @@index([createdAt(sort: Desc)], map: "idx_documents_created")
  @@index([extractedData], map: "idx_documents_extracted_gin", type: Gin)
  @@index([organizationId], map: "idx_documents_org")
  @@index([uploadedBy], map: "idx_documents_uploaded_by")
}

model invitation {
  id             String       @id
  organizationId String
  email          String
  role           String?
  status         String
  expiresAt      DateTime     @db.Timestamptz(6)
  createdAt      DateTime     @default(now()) @db.Timestamptz(6)
  inviterId      String
  user           user         @relation(fields: [inviterId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  organization   organization @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([email])
  @@index([organizationId])
}

model member {
  id             String       @id
  organizationId String
  userId         String
  role           String
  createdAt      DateTime     @db.Timestamptz(6)
  organization   organization @relation(fields: [organizationId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user           user         @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([organizationId])
  @@index([userId])
}

model organization {
  id         String       @id
  name       String
  slug       String       @unique
  logo       String?
  createdAt  DateTime     @db.Timestamptz(6)
  metadata   String?
  documents  documents[]
  invitation invitation[]
  member     member[]
}

model session {
  id                   String   @id
  expiresAt            DateTime @db.Timestamptz(6)
  token                String   @unique
  createdAt            DateTime @default(now()) @db.Timestamptz(6)
  updatedAt            DateTime @db.Timestamptz(6)
  ipAddress            String?
  userAgent            String?
  userId               String
  activeOrganizationId String?
  user                 user     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([userId])
}

model user {
  id            String       @id
  name          String
  email         String       @unique
  emailVerified Boolean
  image         String?
  createdAt     DateTime     @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime     @default(now()) @db.Timestamptz(6)
  account       account[]
  documents     documents[]
  invitation    invitation[]
  member        member[]
  session       session[]
}

model verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime @db.Timestamptz(6)
  createdAt  DateTime @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime @default(now()) @db.Timestamptz(6)

  @@index([identifier])
}

enum document_status {
  pending
  processing
  completed
  failed
}

enum document_type {
  bank_statement
  invoice
  receipt
  unknown
}
